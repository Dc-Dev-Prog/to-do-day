# üöÄ INSTALACI√ìN R√ÅPIDA - WALLET MANAGER SUI
# Ejecutar desde la carpeta ra√≠z del proyecto

param(
    [switch]$Help
)

if ($Help) {
    Write-Host "
üöÄ INSTALACI√ìN WALLET MANAGER SUI
================================

USO:
    .\install-wallet-manager.ps1

ACCIONES:
- ‚úÖ Verifica estructura de carpetas
- ‚úÖ Crea accesos directos
- ‚úÖ Prueba funcionamiento
- ‚úÖ Muestra ayuda de uso

UBICACI√ìN FINAL:
- .\.script\wallet-manager\
" -ForegroundColor Green
    return
}

$ErrorActionPreference = "Stop"
$BaseDir = $PSScriptRoot

Write-Host "
üöÄ INSTALANDO WALLET MANAGER SUI
===============================
" -ForegroundColor Yellow

# Verificar ubicaci√≥n
$WalletDir = Join-Path $BaseDir ".script\wallet-manager"
if (!(Test-Path $WalletDir)) {
    Write-Host "‚ùå Error: No se encuentra la carpeta wallet-manager" -ForegroundColor Red
    Write-Host "üìç Se esperaba en: $WalletDir" -ForegroundColor Yellow
    return
}

Write-Host "‚úÖ Carpeta wallet-manager encontrada" -ForegroundColor Green

# Verificar archivos principales
$MainScript = Join-Path $WalletDir "wallet-manager.ps1"
$ReadmeFile = Join-Path $WalletDir "README.md"

if (!(Test-Path $MainScript)) {
    Write-Host "‚ùå Error: Script principal no encontrado" -ForegroundColor Red
    return
}

Write-Host "‚úÖ Script principal verificado" -ForegroundColor Green

# Crear acceso directo en la ra√≠z
$ShortcutPath = Join-Path $BaseDir "wallet-manager-quick.ps1"
$ShortcutContent = @"
# üíº ACCESO R√ÅPIDO - WALLET MANAGER SUI
# Ejecuta el wallet manager desde cualquier ubicaci√≥n

`$WalletScript = Join-Path `$PSScriptRoot ".script\wallet-manager\wallet-manager.ps1"

if (Test-Path `$WalletScript) {
    & `$WalletScript @args
} else {
    Write-Host "‚ùå Error: Wallet manager no encontrado en .script\wallet-manager\" -ForegroundColor Red
    Write-Host "üí° Ejecuta .\install-wallet-manager.ps1 para verificar instalaci√≥n" -ForegroundColor Yellow
}
"@

Set-Content -Path $ShortcutPath -Value $ShortcutContent -Encoding UTF8
Write-Host "‚úÖ Acceso r√°pido creado: wallet-manager-quick.ps1" -ForegroundColor Green

# Probar funcionamiento
Write-Host "
üîç PROBANDO FUNCIONAMIENTO...
============================" -ForegroundColor Cyan

try {
    $TestResult = & $MainScript -Lista 2>&1
    if ($LASTEXITCODE -eq 0 -or $TestResult -match "WALLETS") {
        Write-Host "‚úÖ Wallet Manager funcionando correctamente" -ForegroundColor Green
    } else {
        Write-Host "‚ö†Ô∏è  Advertencia: Respuesta inesperada del script" -ForegroundColor Yellow
    }
} catch {
    Write-Host "‚ùå Error durante la prueba: $($_.Exception.Message)" -ForegroundColor Red
}

# Mostrar ayuda de uso
Write-Host "
üìã USO R√ÅPIDO:
==============
Desde la ra√≠z del proyecto:
    .\wallet-manager-quick.ps1 -Lista
    .\wallet-manager-quick.ps1 -Balance -Red all
    .\wallet-manager-quick.ps1 -Export

Desde la carpeta wallet-manager:
    cd .\.script\wallet-manager
    .\wallet-manager.ps1 -Lista

üìñ DOCUMENTACI√ìN COMPLETA:
    .\.script\wallet-manager\README.md
    .\.script\wallet-manager\examples\EJEMPLOS.md

üéâ INSTALACI√ìN COMPLETADA
========================
" -ForegroundColor Green