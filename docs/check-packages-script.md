# üì¶ Verificador de Paquetes Inteligente

El script `check-packages.ps1` proporciona una vista completa de todos los paquetes Sui desplegados y sus capabilities de actualizaci√≥n.

## üìã Tabla de Contenidos

- [Caracter√≠sticas Principales](#caracter√≠sticas-principales)
- [Par√°metros del Script](#par√°metros-del-script)  
- [Uso B√°sico](#uso-b√°sico)
- [Modos de Visualizaci√≥n](#modos-de-visualizaci√≥n)
- [Ejemplos Detallados](#ejemplos-detallados)
- [Interpretando la Salida](#interpretando-la-salida)

---

## Caracter√≠sticas Principales

### Detecci√≥n Completa de Paquetes
- Encuentra autom√°ticamente todos los UpgradeCaps en tu wallet
- Lee informaci√≥n del √∫ltimo despliegue registrado
- Identifica paquetes actualizables vs inmutables
- Muestra estad√≠sticas completas de tus despliegues

### An√°lisis Inteligente
- Conecta UpgradeCaps con sus Package IDs correspondientes
- Muestra versiones y estados de los paquetes
- Proporciona sugerencias de pr√≥ximos pasos
- Detecta la red activa autom√°ticamente

### Informaci√≥n Contextual
- Integra datos del archivo `ultimo-despliegue.txt`
- Proporciona enlaces a otros scripts relacionados
- Muestra estad√≠sticas resumidas
- Ofrece opciones de visualizaci√≥n flexible

---

## Par√°metros del Script

| Par√°metro | Tipo | Descripci√≥n |
|-----------|------|-------------|
| `-Red` | String | Verificar paquetes en red espec√≠fica |
| `-Detallado` | Switch | Muestra informaci√≥n t√©cnica adicional |
| `-SoloActualizables` | Switch | Solo muestra paquetes con UpgradeCap |

---

## Uso B√°sico

### Verificaci√≥n Completa
```powershell
.\.script\check-packages.ps1
```

### Salida T√≠pica
```
üì¶ VERIFICADOR INTELIGENTE DE PAQUETES SUI
=========================================

üåê Red actual: testnet

üîç BUSCANDO UPGRADE CAPABILITIES...

‚≠ê √öLTIMO DESPLIEGUE REGISTRADO:
üìã PAQUETE: 0x8ddace66e376f03067016c51820d512fa1a8fa9e2e518ed0c842086cdb27ae91
   üè∑Ô∏è  Versi√≥n: N/A
   üîë UpgradeCap: 0x039aba13ae7fae8f7ad0537f5ede79c334fbcc40055b9c14b6db737472967ab0
   ‚úÖ Actualizable: S√ç

üîç OTROS PAQUETES ACTUALIZABLES:
üìã PAQUETE: 0x5d0d6b1d4c035ef09abe4a3cd9e395673c3e3290b3f17bca5583ae3f2bb6802c
   üè∑Ô∏è  Versi√≥n: 1
   üîë UpgradeCap: 0x5d0d6b1d4c035ef09abe4a3cd9e395673c3e3290b3f17bca5583ae3f2bb6802c
   ‚úÖ Actualizable: S√ç

üìà ESTAD√çSTICAS:
   üì¶ Total paquetes actualizables: 2
   üîë UpgradeCaps disponibles: 3
   üåê Red actual: testnet

üéØ PR√ìXIMOS PASOS:
   ‚Ä¢ Para actualizar: .\.script\upgrade.ps1
   ‚Ä¢ Para calcular costos: .\.script\calcular-costo-despliegue.ps1
   ‚Ä¢ Para nuevo despliegue: .\.script\deploy.ps1
```

---

## Modos de Visualizaci√≥n

### Modo B√°sico (Default)
```powershell
.\.script\check-packages.ps1
```
Muestra informaci√≥n esencial de todos los paquetes

### Modo Detallado
```powershell
.\.script\check-packages.ps1 -Detallado
```
Incluye informaci√≥n t√©cnica adicional como fechas de creaci√≥n y metadata

### Solo Actualizables
```powershell
.\.script\check-packages.ps1 -SoloActualizables
```
Filtra para mostrar √∫nicamente paquetes que pueden ser actualizados

### Red Espec√≠fica
```powershell
.\.script\check-packages.ps1 -Red mainnet
```
Verifica paquetes en una red espec√≠fica

---

## Ejemplos Detallados

### Ejemplo 1: Primera Verificaci√≥n
```powershell
PS> .\.script\check-packages.ps1

üì¶ VERIFICADOR INTELIGENTE DE PAQUETES SUI
=========================================

üåê Red actual: testnet

üîç BUSCANDO UPGRADE CAPABILITIES...

‚ùå NO SE ENCONTRARON PAQUETES DESPLEGADOS
   üí° Consejos:
      ‚Ä¢ Verifica que est√©s en la red correcta
      ‚Ä¢ Usa .\.script\deploy.ps1 para desplegar contratos
      ‚Ä¢ Revisa si tienes paquetes en otras redes

‚úÖ Verificaci√≥n completa!
```

### Ejemplo 2: M√∫ltiples Paquetes con Modo Detallado
```powershell
PS> .\.script\check-packages.ps1 -Detallado

üì¶ VERIFICADOR INTELIGENTE DE PAQUETES SUI
=========================================

üåê Red actual: testnet

‚≠ê √öLTIMO DESPLIEGUE REGISTRADO:
üìã PAQUETE: 0x8ddace66e376f03067016c51820d512fa1a8fa9e2e518ed0c842086cdb27ae91
   üè∑Ô∏è  Versi√≥n: N/A
   üîë UpgradeCap: 0x039aba13ae7fae8f7ad0537f5ede79c334fbcc40055b9c14b6db737472967ab0
   ‚úÖ Actualizable: S√ç
   üîç Obteniendo detalles...
   üìÖ Creado: Versi√≥n 1

üîç OTROS PAQUETES ACTUALIZABLES:
üìã PAQUETE: 0x5d0d6b1d4c035ef09abe4a3cd9e395673c3e3290b3f17bca5583ae3f2bb6802c
   üè∑Ô∏è  Versi√≥n: 2
   üîë UpgradeCap: 0x5d0d6b1d4c035ef09abe4a3cd9e395673c3e3290b3f17bca5583ae3f2bb6802c
   ‚úÖ Actualizable: S√ç
   üìÖ Creado: Versi√≥n 2

üìà ESTAD√çSTICAS:
   üì¶ Total paquetes actualizables: 2
   üîë UpgradeCaps disponibles: 3
   üåê Red actual: testnet
```

### Ejemplo 3: Verificaci√≥n en Mainnet
```powershell
PS> .\.script\check-packages.ps1 -Red mainnet

üì¶ VERIFICADOR INTELIGENTE DE PAQUETES SUI
=========================================

üåê Red actual: testnet
üîÑ Cambiando a mainnet...

üîç BUSCANDO UPGRADE CAPABILITIES...

‚≠ê √öLTIMO DESPLIEGUE REGISTRADO:
üìã PAQUETE: 0x41c0712233a64af3b69dd5f2a557b3a05f4dabdaba0300880e130d59381be03f
   üè∑Ô∏è  Versi√≥n: N/A
   üîë UpgradeCap: 0x987fed543ab2c1d0e9f8g7h6i5j4k3l2m1n0o9p8q7r6s5t4u3v2w1x0y9z8
   ‚úÖ Actualizable: S√ç

üìà ESTAD√çSTICAS:
   üì¶ Total paquetes actualizables: 1
   üîë UpgradeCaps disponibles: 1
   üåê Red actual: mainnet
```

---

## Interpretando la Salida

### Secciones de la Salida

#### √öltimo Despliegue Registrado
- **Fuente**: Archivo `ultimo-despliegue.txt`
- **Informaci√≥n**: Package ID, UpgradeCap, fecha de despliegue
- **Prop√≥sito**: Identificar tu despliegue m√°s reciente

#### Otros Paquetes Actualizables  
- **Fuente**: B√∫squeda en objetos del wallet
- **Informaci√≥n**: Todos los UpgradeCaps encontrados
- **Prop√≥sito**: Ver todos los paquetes que puedes actualizar

#### Estad√≠sticas Resumidas
- **Total paquetes actualizables**: Cu√°ntos contratos puedes actualizar
- **UpgradeCaps disponibles**: Cu√°ntos UpgradeCaps tienes
- **Red actual**: En qu√© red est√°s verificando

### Estados de Paquetes

| Estado | Descripci√≥n | Acci√≥n Disponible |
|--------|-------------|-------------------|
| ‚úÖ **Actualizable: S√ç** | Tiene UpgradeCap | Puede ser actualizado |
| ‚ùå **Actualizable: NO** | Sin UpgradeCap | Solo lectura, inmutable |
| ‚ö†Ô∏è **Error** | No se puede acceder | Verificar permisos |

---

## Casos de Uso Espec√≠ficos

### Auditor√≠a de Paquetes
```powershell
# Ver todos los paquetes en todas las redes
.\.script\check-packages.ps1 -Red testnet
.\.script\check-packages.ps1 -Red mainnet
.\.script\check-packages.ps1 -Red devnet
```

### Preparaci√≥n para Actualizaci√≥n
```powershell
# Ver solo paquetes actualizables
.\.script\check-packages.ps1 -SoloActualizables
```

### An√°lisis T√©cnico Detallado
```powershell
# Informaci√≥n completa con detalles t√©cnicos
.\.script\check-packages.ps1 -Detallado
```

### Verificaci√≥n Cruzada de Redes
```powershell
# Comparar despliegues entre redes
.\.script\check-packages.ps1 -Red testnet -Detallado
.\.script\check-packages.ps1 -Red mainnet -Detallado
```

---

## Integraci√≥n con Otros Scripts

### Flujo de Desarrollo T√≠pico

```powershell
# 1. Verificar estado actual
.\.script\check-packages.ps1

# 2. Si no hay paquetes, desplegar uno nuevo
.\.script\deploy.ps1

# 3. Si hay paquetes, calcular costo de actualizaci√≥n
.\.script\calcular-costo-despliegue.ps1 solo-actualizacion

# 4. Actualizar paquete existente
.\.script\upgrade.ps1
```

### Uso en Conjunto

#### Con deploy.ps1
```powershell
# Verificar antes de desplegar para evitar duplicados
.\.script\check-packages.ps1
.\.script\deploy.ps1  # Solo si no hay paquetes o quieres uno nuevo
```

#### Con upgrade.ps1
```powershell
# Identificar qu√© actualizar
.\.script\check-packages.ps1 -SoloActualizables
.\.script\upgrade.ps1  # Usa la informaci√≥n detectada autom√°ticamente
```

#### Con calcular-costo-despliegue.ps1
```powershell
# Verificar paquetes existentes antes de calcular costos
.\.script\check-packages.ps1
.\.script\calcular-costo-despliegue.ps1 ambos  # Calcula para despliegue y actualizaci√≥n
```

---

## Soluci√≥n de Problemas

### "No se encontraron paquetes desplegados"

**Posibles causas:**
- Est√°s en la red incorrecta
- No has desplegado ning√∫n contrato
- Los contratos fueron desplegados desde otra direcci√≥n

**Soluciones:**
1. Verificar red activa: `sui client active-env`
2. Cambiar de red: `sui client switch --env <red>`
3. Verificar direcci√≥n activa: `sui client active-address`
4. Desplegar primer contrato: `.\.script\deploy.ps1`

### "Error al obtener detalles"

**Posibles causas:**
- Problemas de conexi√≥n con la red
- UpgradeCap inv√°lido o eliminado
- Permisos insuficientes

**Soluciones:**
1. Verificar conexi√≥n: `sui client objects`
2. Usar modo b√°sico en lugar de detallado
3. Verificar manualmente: `sui client object <UpgradeCap-ID>`

### Comandos de Diagn√≥stico
```powershell
# Verificar configuraci√≥n b√°sica
sui client active-env
sui client active-address
sui client balance

# Ver todos los objetos (incluye UpgradeCaps)
sui client objects

# Verificar un UpgradeCap espec√≠fico
sui client object <UpgradeCap-ID> --json

# Ver redes configuradas
sui client envs
```

---

## Informaci√≥n T√©cnica

### Estructura del Archivo ultimo-despliegue.txt
```
Package ID: 0x8ddace66e376f03067016c51820d512fa1a8fa9e2e518ed0c842086cdb27ae91
Upgrade Cap ID: 0x039aba13ae7fae8f7ad0537f5ede79c334fbcc40055b9c14b6db737472967ab0
Red: testnet
Fecha: 9/24/2025 10:30:15 AM
Proyecto: to_do_day
√öltimo update: 9/24/2025 2:45:30 PM
```

### Detecci√≥n de UpgradeCaps
El script busca objetos que coincidan con el patr√≥n:
```
(0x[a-f0-9]+).*UpgradeCap
```

### Obtenci√≥n de Package IDs
Para cada UpgradeCap encontrado, el script ejecuta:
```powershell
$capInfo = sui client object $upgradeCapId --json | ConvertFrom-Json
$packageId = $capInfo.content.fields.package
```

---

## Mejores Pr√°cticas

### Verificaci√≥n Regular
```powershell
# Ejecutar regularmente para mantener visibilidad
.\.script\check-packages.ps1 -Detallado
```

### Antes de Actualizaciones
```powershell
# Siempre verificar antes de actualizar
.\.script\check-packages.ps1 -SoloActualizables
.\.script\upgrade.ps1
```

### Gesti√≥n Multi-Red
```powershell
# Mantener inventario de todas las redes
.\.script\check-packages.ps1 -Red testnet > testnet-packages.txt
.\.script\check-packages.ps1 -Red mainnet > mainnet-packages.txt
```

### Documentaci√≥n
- Guarda las salidas del script para documentaci√≥n
- Usa modo detallado para registros importantes
- Combina con screenshots para documentaci√≥n visual

---

## Scripts Relacionados

- **[üöÄ deploy.ps1](deploy-script.md)** - Para desplegar nuevos contratos
- **[üîÑ upgrade.ps1](upgrade-script.md)** - Para actualizar contratos existentes  
- **[üí∞ calcular-costo-despliegue.ps1](cost-calculator-script.md)** - Para estimar costos

---

¬°Con este script siempre tendr√°s visibilidad completa de tus paquetes Sui desplegados! üì¶